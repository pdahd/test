name: Download BT Link with Transmission

on:
  workflow_dispatch:

jobs:
  download:
    runs-on: ubuntu-latest
    timeout-minutes: 60 # 设置超时时间，防止长时间卡住

    steps:
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y transmission-cli

      - name: Download BT link
        id: download_bt
        continue-on-error: true
        run: |
          BT_LINK="magnet:?xt=urn:btih:99ffbc44b8328390b9bbb7ef942ebcc042782b0e&dn=[www.domp4.cc]%E5%BC%82%E5%BD%A2%EF%BC%9A%E5%A4%BA%E5%91%BD%E8%88%B0.2024.BD1080p.%E5%9B%BD%E8%8B%B1%E5%8F%8C%E8%AF%AD.%E4%B8%AD%E8%8B%B1%E5%AD%97.mp4&tr=..."
          transmission-remote -a "$BT_LINK" -w bt_downloads || echo "::set-output name=download_failed::true" # -w 指定下载目录

      - name: Check download status
        if: steps.download_bt.outputs.download_failed == 'true'
        run: echo "BT download failed. Check logs for details."

      - name: List downloaded files (if successful)
        if: steps.download_bt.outputs.download_failed != 'true'
        run: |
          ls -l bt_downloads
          du -sh bt_downloads

      - name: Archive downloaded files (Optional, if needed)
        if: steps.download_bt.outputs.download_failed != 'true'
        uses: actions/upload-artifact@v4
        with:
          name: bt_downloads
          path: bt_downloads

      
